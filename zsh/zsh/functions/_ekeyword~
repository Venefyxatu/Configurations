#compdef ekeyword

# Author: Diego Petten√≤ <flameeyes@gentoo.org>
# Inspired by _portage_utils completion by baptux <baptiste.daroussin@gmail.com>


local PORTDIR
var=PORTDIR
[[ -z ${(P)var} && -r /etc/make.conf ]] &&
local $var="`. /etc/make.conf 2>/dev/null; echo ${(P)var}`"
[[ -z ${(P)var} && -r /etc/make.globals ]] &&
local $var="`. /etc/make.globals 2>/dev/null; echo ${(P)var}`"

local arches allarches arch
show_archs(){
	arches=(${(f)"$(<$PORTDIR/profiles/arch.list)"})
	allarches=($archs)
	for arch in $arches;do
		allarches=($allarches $arch "\\~$arch")
	done
	_describe -t available-arches "arch" allarches
}

files_and_arches(){
	show_archs
	_files -g "*.ebuild"
}

_arguments -s \
	   '*:parameters:files_and_arches'
